<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Company Wise Leetcode</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Jost&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="static\style.css" />
  <script src="static\script.js"></script>
</head>

<body data-bs-theme="dark">
  <div class="container-fluid p-md-3">
    <a href="/" class="text-decoration-none">
      <h4>
        <span class="btn bg-dark border-secondary rounded"><i class="bi bi-house-door"></i> Home</span>
      </h4>
    </a>

    <div class="row justify-content-evenly">
      <div class="col-12 col-md-6">
        <div class="glass-card">
          <div class="questionlistcss">
            <h2 class="mb-2" id="IdTitle">
              {{ problem.questionId }}. {{ problem.title }}
            </h2>
            <p>Difficulty: {{ problem.difficulty }}</p>
            <h5 class="mb-2">Description</h5>
            <div class="border rounded p-3">{{ problem.content | safe }}</div>

            <!-- Company Tags Section -->
            <!-- <p>{{ problem.companyTagStatsV2 }}</p>
{% if problem.companyTagStatsV2 %}
    <div class="mt-3">
        <h6 class="mb-2">Company Tags</h6>
        <div class="d-flex flex-wrap gap-2">
            {% for company in problem.companyTagStatsV2 %}
                <span class="badge bg-info">{{ company.company }}</span>
            {% endfor %}
        </div>
    </div>
{% endif %} -->

            <!-- Hints Section -->
            {% if problem.hints %}
            <div class="mt-3">
              <h6 class="mb-2">Hints</h6>
              <ul class="list-group">
                {% for hint in problem.hints %}
                <li class="list-group-item">{{ hint }}</li>
                {% endfor %}
              </ul>
            </div>
            {% endif %}

            <!-- Code Snippets Section -->
            <!-- {% if problem.codeSnippets %}
    <div class="mt-3">
        <h6 class="mb-2">Code Snippets</h6>
        <div class="d-flex flex-wrap gap-3">
            {% for snippet in problem.codeSnippets %}
                <div class="card p-3">
                    <pre><code class="language-{{ snippet.langSlug }}">{{ snippet.code }}</code></pre>
                    <p class="text-muted">{{ snippet.lang }}</p>
                </div>
            {% endfor %}
        </div>
    </div>
{% endif %} -->

            <!-- Example Testcases Section -->
            {% if problem.exampleTestcaseList %}
            <div class="mt-3">
              <h6 class="mb-2">Example Testcases</h6>
              <ul class="list-group">
                {% for testcase in problem.exampleTestcaseList %}
                <li class="list-group-item w-100">
                  <div>
                    {% set my_list = testcase.split("\n") %} Input: {{
                    my_list[0] }}<br />
                    {% if my_list[1] %} Output: {{ my_list[1] }} {% endif %}
                  </div>
                </li>
                {% endfor %}
              </ul>
            </div>
            {% endif %}
            <!-- Similar Questions Section -->
            {% if problem.similarQuestionList %}
            <div class="mt-3">
              <h6 class="mb-2">Similar Questions</h6>
              <div class="d-flex flex-wrap gap-2">
                {% for similar_question in problem.similarQuestionList %}
                <a href="/solve?title={{ similar_question.titleSlug }}" class="text-decoration-none">
                  <h5>
                    <span class="badge bg-secondary">{{ similar_question.title }}
                    </span>
                  </h5>
                </a>
                {% endfor %}
              </div>
            </div>
            {% endif %}

            <div class="d-flex flex-column flex-md-row justify-content-between align-items-center gap-3 mt-2">
              <div>
                <h6 class="mb-2">Tags</h6>
                <div class="d-flex flex-wrap gap-2">
                  {% for tag in problem.topicTags %}
                  <h5>
                    <span class="badge bg-dark border">{{ tag.name }} </span>
                  </h5>
                  {% endfor %}
                </div>
              </div>

              <div class="mt-2 mt-md-0">
                <a href="https://leetcode.com/problems/{{ request.args.get('title') }}/" target="_blank"
                  class="btn btn-primary">
                  Solve on LeetCode â†’
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="glass-card">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="m-0">Code Editor</h4>
            <select id="language-select" class="form-select w-auto">
              <option value="CPP">C++</option>
              <option value="Java" selected>Java</option>
              <option value="Python">Python</option>
              <option value="JavaScript">JavaScript</option>
            </select>
          </div>
          <div id="editor"></div>
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mt-2">
            <div class="mt-2">
              <button id="analyze-btn" class="btn btn-primary">
                Analyze Code
              </button>
              <button id="stuck-btn" class="btn btn-outline-warning ms-1">
                Stuck? Ask AI
              </button>
              <div class="mt-3 w-100">
                <div id="analysis-result" class="card bg-dark text-white border rounded shadow-sm p-3"
                  style="display: none">
                  <!-- Analysis will be inserted here -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Load Monaco Editor -->
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@latest/min/vs/loader.js"></script>

  <script>
    let editor;

    const defaultCode = {
      CPP: `{{ problem.codeSnippets[0].code | safe }}`,
      Java: `{{ problem.codeSnippets[1].code | safe }}`,
      Python: `{{ problem.codeSnippets[2].code | safe }}`,
      JavaScript: `{{ problem.codeSnippets[6].code | safe }}`,
    };

    // Set initial language and value for Monaco Editor
    let initialLanguage = "Java"; // This is the default selected language
    let initialCode = defaultCode[initialLanguage];

    // Monaco editor initialization
    require.config({
      paths: {
        vs: "https://cdn.jsdelivr.net/npm/monaco-editor@latest/min/vs",
      },
    });

    require(["vs/editor/editor.main"], function () {
      // Initialize Monaco Editor with default Java code
      editor = monaco.editor.create(document.getElementById("editor"), {
        value: initialCode, // Use the initial code for Java or any selected language
        language: initialLanguage.toLowerCase(), // Monaco language is lowercase (e.g., 'java' instead of 'Java')
        theme: "vs-dark",
        automaticLayout: true,
        minimap: { enabled: false },
      });

      // Handle language change in the dropdown
      document
        .getElementById("language-select")
        .addEventListener("change", function () {
          const selectedLanguage = this.value; // Get the selected language from the dropdown
          const selectedCode = defaultCode[selectedLanguage]; // Get the corresponding code for the selected language

          // Update Monaco editor with the new language and code
          monaco.editor.setModelLanguage(
            editor.getModel(),
            selectedLanguage.toLowerCase()
          ); // Update language
          editor.setValue(selectedCode); // Set the new code in the editor
        });
    });

    // document.getElementById('analyze-btn').addEventListener('click', async () => {
    //   const code = editor.getValue();
    //   const language = document.getElementById('language-select').value;

    //   try {
    //     const response = await fetch('/analyze', {
    //       method: 'POST',
    //       headers: {
    //         'Content-Type': 'application/json'
    //       },
    //       body: JSON.stringify({ code, language })
    //     });

    //     const data = await response.json();

    //     if (response.ok) {
    //       alert("Analysis Result:\n\n" + JSON.stringify(data, null, 2));
    //     } else {
    //       alert("Error: " + data.error);
    //     }
    //   } catch (error) {
    //     alert("Network error: " + error.message);
    //   }
    // });

    document
      .getElementById("analyze-btn")
      .addEventListener("click", async () => {
        const code = editor.getValue();
        const language = document.getElementById("language-select").value;
        const idtitle = document.getElementById("IdTitle").textContent.trim();

        const resultBox = document.getElementById("analysis-result");
        resultBox.style.display = "block";
        resultBox.innerHTML =
          "<i class='bi bi-search'></i>  <em>Analyzing...</em>";

        try {
          const response = await fetch("/analyze", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              code,
              language,
              idtitle,
            }),
          });

          const data = await response.json();

          if (response.ok) {
            let html = `
        <h5 class="mb-3  text-info-emphasis">Analysis Result</h5>
        <p><span class="text-primary-emphasis">Verification:</span> ${data.verify || "N/A"
              }</p>
        <p><span class="text-primary-emphasis">Explanation:</span> ${data.explanation || "N/A"
              }</p>
        <p><span class="text-primary-emphasis">Time Complexity:</span> 
          ${data.time_complexity
                ? `
            Avg: ${data.time_complexity.average || "-"}, 
            Best: ${data.time_complexity.best || "-"}, 
            Worst: ${data.time_complexity.worst || "-"}
          `
                : "N/A"
              }
        </p>
        <p><span class="text-primary-emphasis">Space Complexity:</span> ${data.space_complexity || "N/A"
              }</p>
        
        <h6 class="text-primary-emphasis">Optimization Suggestions</h6>
        <ul>${(data.optimization_suggestions || [])
                .map((s) => `<li>${s}</li>`)
                .join("")}</ul>
        
      `;

            resultBox.innerHTML = html;
          } else {
            resultBox.innerHTML = `<span class="text-danger">Error: ${data.error}</span>`;
          }
        } catch (error) {
          resultBox.innerHTML = `<span class="text-danger">Network error: ${error.message}</span>`;
        }
      });

    document
      .getElementById("stuck-btn")
      .addEventListener("click", async () => {
        const code = editor.getValue();
        const language = document.getElementById("language-select").value;
        const idtitle = document.getElementById("IdTitle").textContent.trim();

        const resultBox = document.getElementById("analysis-result");
        resultBox.style.display = "block";
        resultBox.innerHTML =
          "<i class='bi bi-lightbulb'></i>  <em>Understanding code...</em>";

        try {
          const response = await fetch("/gotstuck", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              code,
              language,
              idtitle,
            }),
          });

          const data = await response.json();

          if (response.ok) {
            const html = `
        <h5 class="mb-3 text-info-emphasis">Hints and Concepts Overview</h5>
        <p><span class="text-primary-emphasis">Analysis:</span> ${data.analysis || "N/A"
              }</p>
        <p><span class="text-primary-emphasis">Key Concepts to use:</span> ${data.keyconcepts || "N/A"
              }</p>
        
      `;
            resultBox.innerHTML = html;
          } else {
            resultBox.innerHTML = `<span class="text-danger">Error: ${data.error}</span>`;
          }
        } catch (error) {
          resultBox.innerHTML = `<span class="text-danger">Network error: ${error.message}</span>`;
        }
      });
  </script>
</body>

</html>